<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Lesson 7: Fitting PRF models to visual space" href="lesson7.html" /><link rel="prev" title="Lesson 5: Decoding noisy neural data" href="lesson5.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>Lesson 6: Decoding two-dimensional stimulus spaces - Braincoder documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=ca2c29f3" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Braincoder  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Braincoder  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Tutorial</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorial</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lesson1.html">Lesson 1: Encoding models</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson2.html">Lesson 2: Linear encoding models</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson3.html">Lesson 3: Building the likelihood (by fitting the covariance matrix)</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson4.html">Lesson 4: From neural responses to stimulus features</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson5.html">Lesson 5: Decoding noisy neural data</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Lesson 6: Decoding two-dimensional stimulus spaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#decode-the-marginal-probability-distribution">Decode the marginal probability distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#decode-the-conditional-probability-distribution">Decode the conditional probability distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-complex-plane">The complex plane</a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson7.html">Lesson 7: Fitting PRF models to visual space</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../auto_examples/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/00_encodingdecoding/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/fit_residuals.html">Fit the residual covariance matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/masked_stimulus_decoding.html">Stimulus decoding using stimulus mask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/linear_encoding_model.html">Linear encoding model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/encoding_model.html">Create a simple Gaussian Prf encoding model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/invert_model.html">Invert encoding model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/decode.html">Decoding of stimuli from neural data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/decode_v1.html">Recontruct a 2D visual stimulus from real fMRI data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/decode_visual.html">Fit a 2D PRF model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/fisher_information.html">Fisher information to estimate precision of encoding parameters across stimulus space</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/fit_prf.html">Different flavors of visual population receptive field models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/fit_prf.html#decoded-stimulus-gaussian-model">Decoded stimulus: Gaussian model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/fit_prf.html#decoded-stimulus-dn-model">Decoded stimulus: DN model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/00_encodingdecoding/decode2d.html">Decoding 2D stimuli from neural data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">General bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="lesson-6-decoding-two-dimensional-stimulus-spaces">
<span id="tutorial-lesson6"></span><h1>Lesson 6: Decoding two-dimensional stimulus spaces<a class="headerlink" href="#lesson-6-decoding-two-dimensional-stimulus-spaces" title="Link to this heading">#</a></h1>
<p>In this lesson, we will decode a <strong>two-dimensional</strong> stimulus
space. Specifically, we are going to assume that the
<em>stimulus drive</em> (<cite>amplitude</cite>) of specific stimuli can be modulated,
for example by the <em>attentional state</em> of the subject
(see, e.g., Serences and Yantis<a class="footnote-reference brackets" href="#footcite-serences2007spatially" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, Sprague and Serences<a class="footnote-reference brackets" href="#footcite-sprague2013attention" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>, and
Sawetsuttipan <em>et al.</em><a class="footnote-reference brackets" href="#footcite-sawetsuttipan2023perceptual" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>).</p>
<p>Hence, every stimulus is now characterized by two parameters:
its <em>orientation</em> (<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">(radians)</span></code>) and its <em>amplitude</em> (<code class="docutils literal notranslate"><span class="pre">amplitude</span></code>).</p>
<p>Let’s set up a virtual <strong>mapping experiment</strong>, where we are simulating data,
estimate parameters, and decode the stimulus space.</p>
<p><em>Crucially</em>, in the mapping experiment, we are (‘rightfully’) going
to assume that the stimulus drive (<code class="docutils literal notranslate"><span class="pre">amplitude</span></code>) is not modulated
and is always <code class="docutils literal notranslate"><span class="pre">1.0</span></code>.</p>
<p>We use the argument <code class="docutils literal notranslate"><span class="pre">model_stimulus_amplitude</span></code> of the <code class="docutils literal notranslate"><span class="pre">VonMisesPRF</span></code>-model
to indicate we want to model both orientation and amplitudes.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a neural model</span>
<span class="kn">from</span> <span class="nn">braincoder.models</span> <span class="kn">import</span> <span class="n">VonMisesPRF</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">ss</span>
<span class="n">noise</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># We are setting up a VonMisesPRF model with 8 orientations,</span>
<span class="c1"># We have 8 voxels, each with a linear combination of the 8 von Mises functions</span>
<span class="c1"># We use the identity matrix with some noice, so that each voxel is driven by</span>
<span class="c1"># largely by a single PRF</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;mu&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="s1">&#39;kappa&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;baseline&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">})</span>

<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mf">5.0</span>
<span class="n">weights</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VonMisesPRF</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">model_stimulus_amplitude</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

<span class="c1"># Note how the stimulus type is now `OneDimensionalRadialStimulusWithAmplitude`</span>
<span class="c1"># which means that the stimulus is two-dimensional</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">stimulus</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">stimulus</span><span class="o">.</span><span class="n">dimension_labels</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;braincoder.stimuli.OneDimensionalRadialStimulusWithAmplitude object at 0x2d2b6dd20&gt;
[&#39;x (radians)&#39;, &#39;amplitude&#39;]
</pre></div>
</div>
<p>Now we simulate data, estimate parameters, and the noise model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapper_paradigm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x (radians)&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">})</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">paradigm</span><span class="o">=</span><span class="n">mapper_paradigm</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">)</span>

<span class="c1"># Set up parameter fitter</span>
<span class="kn">from</span> <span class="nn">braincoder.optimize</span> <span class="kn">import</span> <span class="n">WeightFitter</span><span class="p">,</span> <span class="n">ResidualFitter</span>
<span class="n">fitter</span> <span class="o">=</span> <span class="n">WeightFitter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mapper_paradigm</span><span class="p">)</span>
<span class="c1"># With 8 overlapping Von Mises functions, we already need some regularisation, hence alpha=1.0</span>
<span class="n">fitted_weights</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># Now we fit the covariance matrix on the residuals</span>
<span class="n">resid_fitter</span> <span class="o">=</span> <span class="n">ResidualFitter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mapper_paradigm</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">fitted_weights</span><span class="p">)</span>
<span class="n">omega</span><span class="p">,</span> <span class="n">dof</span> <span class="o">=</span> <span class="n">resid_fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">progressbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

</pre></div>
</div>
<p>After fitting the mapping paradigm, we are now going to simulate an
experiment with two conditions, where the stimulus drive is modulated
in the <strong>attended</strong> condition, the stimulus drive is modulated by a factor of <strong>``1.5``</strong>,
whereas in the <strong>unattended</strong> condition, the stimulus drive is modulated by a factor of <strong>``0.5``</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we set up an experimental paradigm with two conditions</span>
<span class="c1"># An `attended` and an `unattended` condition.</span>
<span class="c1"># In the attended condition, the stimulus will have more drive (1.5),</span>
<span class="c1"># in the unattended condition, the stimulus will have less drive (0.5).</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">experimental_paradigm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mf">2.</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;attended&#39;</span><span class="p">,</span> <span class="s1">&#39;unattended&#39;</span><span class="p">]],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="s1">&#39;condition&#39;</span><span class="p">]))</span>

<span class="c1"># Random orientations</span>
<span class="n">experimental_paradigm</span><span class="p">[</span><span class="s1">&#39;x (radians)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="c1"># Amplitudes have some noise</span>
<span class="n">experimental_paradigm</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">experimental_paradigm</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;condition&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;attended&#39;</span><span class="p">,</span> <span class="n">ss</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ss</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">experimental_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">paradigm</span><span class="o">=</span><span class="n">experimental_paradigm</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">)</span>


</pre></div>
</div>
<p>If we plot the simulated responses as a function of the ground truth orientation,
we can clearly see both the preferred orientation and the modulation of the stimulus drive
in the attended condition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the data</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">experimental_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">experimental_paradigm</span><span class="p">[</span><span class="s1">&#39;x (radians)&#39;</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="s1">&#39;x (radians)&#39;</span><span class="p">,</span> <span class="s1">&#39;activity&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>

</pre></div>
</div>
<p class="centered">
<strong><img alt="data" src="../_images/sphx_glr_decode2d_001.png" /></strong></p><p>Now we have the data and the noise model we can, for each data point, calculate its likelihood
given different plausible stimuli. Note that this set of plausible stimuli
consistutes a (flat) prior, so after normalizing likelihoods, we can interpret
the likelihood as a posterior distribution.
Also, remember that we use the PRF and noise parameters that we estimated
in the mapping experiment!</p>
<p>Note how we use the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> library to flexibly manipulate the multidimensional likelihood;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we can calculate the 2D likelihood/posterior of different orientations+amplitudes for the data</span>
<span class="n">lower_amplitude</span><span class="p">,</span> <span class="n">higher_amplitude</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.5</span>
<span class="n">potential_amplitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lower_amplitude</span><span class="p">,</span> <span class="n">higher_amplitude</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">potential_orientations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Make sure ground truth is the potential stimuli</span>
<span class="n">potential_amplitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">potential_amplitudes</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]))</span>

<span class="c1"># We use the `pd.MultiIndex.from_product` function to create a grid of possible stimuli</span>
<span class="n">potential_stimuli</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">potential_orientations</span><span class="p">,</span> <span class="n">potential_amplitudes</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x (radians)&#39;</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Now we get, for each data point, the likelihood of each possible stimulus</span>
<span class="n">ll</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_stimulus_pdf</span><span class="p">(</span><span class="n">experimental_data</span><span class="p">,</span> <span class="n">potential_stimuli</span><span class="p">)</span>

</pre></div>
</div>
<p>Here we plot the posterior distribution for the first 9 data points of the <strong>attended</strong>
and <strong>unattended</strong> conditions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot 2D posteriors for first 9 trials</span>

<span class="c1"># Once we have these 2D likelihoods, now we want to be able to plot them.</span>
<span class="k">def</span> <span class="nf">plot_trial</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">ll</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="n">experimental_paradigm</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># We use the `stack` method to turn the `amplitude` dimension into a column</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>
    
    <span class="c1"># Use imshow to show a 2D image of the likelihood</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ll</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">lower_amplitude</span><span class="p">,</span> <span class="n">higher_amplitude</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>

    <span class="c1"># Plot the _actual_ ground truth amplitude and orientation</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">paradigm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;amplitude&#39;</span><span class="p">],</span> <span class="n">paradigm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;x (radians)&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>

    <span class="c1"># Some housekeeping for the subplots</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Trial </span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlabel</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Orientation&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>

<span class="k">def</span> <span class="nf">plot_condition</span><span class="p">(</span><span class="n">condition</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the 2D posterior for a given condition for the first 9 trials.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    condition (str): The condition for which to plot the posterior.</span>

<span class="sd">    Returns:</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">ix</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ix</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

        <span class="n">plot_trial</span><span class="p">((</span><span class="n">ix</span><span class="p">,</span> <span class="n">condition</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;2D posterior (</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s1"> trials)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plot_condition</span><span class="p">(</span><span class="s1">&#39;attended&#39;</span><span class="p">)</span>
<span class="n">plot_condition</span><span class="p">(</span><span class="s1">&#39;unattended&#39;</span><span class="p">)</span>

</pre></div>
</div>
<p class="centered">
<strong><img alt="attended_posterior" src="../_images/sphx_glr_decode2d_002.png" /></strong></p><p class="centered">
<strong><img alt="unattended_posterior" src="../_images/sphx_glr_decode2d_003.png" /></strong></p><dl class="simple">
<dt>These 2D posterior distributions are very insightful! Notice, for example:</dt><dd><ul class="simple">
<li><p>The orientation of the attended stimulus is more precisely defined in the posterior than the unattended stimulus.</p></li>
<li><p>The amplitude of the attended stimulus is more precisely defined in the posterior than the unattended stimulus.</p></li>
<li><p>The MAP estimate/mean posterior (red <code class="docutils literal notranslate"><span class="pre">+</span></code>) are closer to the ground truth for the attended stimulus than the unattended stimulus.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="decode-the-marginal-probability-distribution">
<h1>Decode the marginal probability distribution<a class="headerlink" href="#decode-the-marginal-probability-distribution" title="Link to this heading">#</a></h1>
<p>When we now want to decode the marginal probability distribution of <code class="docutils literal notranslate"><span class="pre">orientation</span></code>
we need to take into the account of the uncertainty of both dimensions. Hence,
we take the expectation, integrating the other dimension away:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[p(\text{orientation}) = \int_{\text{amplitude}} p(\text{orientation}, \text{amplitude}) da\]</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we can calculate the 1D posterior for specific orientations _or_ amplitudes</span>

<span class="c1"># Marginalize out orientations</span>
<span class="n">amplitudes_posterior</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;amplitude&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">amplitudes_posterior</span> <span class="o">=</span> <span class="n">amplitudes_posterior</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">amplitudes_posterior</span><span class="p">,</span> <span class="n">amplitudes_posterior</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># This is the same as normalizing the posterior</span>

<span class="c1"># Marginalize out amplitudes</span>
<span class="n">orientations_posterior</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;x (radians)&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">orientations_posterior</span> <span class="o">=</span> <span class="n">orientations_posterior</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">orientations_posterior</span><span class="p">,</span> <span class="n">orientations_posterior</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot orientation posteriors</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">orientations_posterior</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="s1">&#39;x (radians)&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>

<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>


</pre></div>
</div>
<p class="centered">
<strong><img alt="orientation_posterior" src="../_images/sphx_glr_decode2d_004.png" /></strong></p></section>
<section id="decode-the-conditional-probability-distribution">
<h1>Decode the conditional probability distribution<a class="headerlink" href="#decode-the-conditional-probability-distribution" title="Link to this heading">#</a></h1>
<p>We see that especially the orientation posterior of the unattended condition is very broad.
Part of the problem is that we have to take into account the uncertainty surrounding the
generating amplitude.
We can make the posterior more precise by using a ground truth amplitude, which we can
use to condition the posterior on:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[p(\text{orientation} | \text{amplitude} = a) = p(\text{orientation}, \text{amplitude} = a)\]</div>
</div>
<p>(With <span class="math notranslate nohighlight">\(a\)</span> being the ground truth amplitude).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the ground truth amplitude to improve the orientation posterior</span>
<span class="c1"># so p(orientation|true_amplitude)</span>
<span class="n">conditional_orientation_ll</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">ll</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s1">&#39;attended&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;condition&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">),</span>
                                        <span class="n">ll</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s1">&#39;unattended&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;condition&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">)),</span>
                                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                        <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;attended&#39;</span><span class="p">,</span> <span class="s1">&#39;unattended&#39;</span><span class="p">],</span>
                                        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="c1"># Normalize!</span>
<span class="n">conditional_orientation_ll</span> <span class="o">=</span> <span class="n">conditional_orientation_ll</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">conditional_orientation_ll</span><span class="p">,</span> <span class="n">conditional_orientation_ll</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">conditional_orientation_ll</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="s1">&#39;x (radians)&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>

<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

</pre></div>
</div>
<p class="centered">
<strong><img alt="orientation_posterior_conditional" src="../_images/sphx_glr_decode2d_005.png" /></strong></p><p>Note how especially for the unattended condition, the orientation posterior is now much more precise.</p>
</section>
<section id="the-complex-plane">
<h1>The complex plane<a class="headerlink" href="#the-complex-plane" title="Link to this heading">#</a></h1>
<p>If we want to have calculate the <em>mean posterior</em> for <code class="docutils literal notranslate"><span class="pre">orientation</span></code> and <code class="docutils literal notranslate"><span class="pre">amplitude</span></code>,
we can use numerical integration. Notice, however, that <code class="docutils literal notranslate"><span class="pre">orientation</span></code> is in polar space,
which means we can not just integrate over raw angles (e.g., what is the mean angle of <code class="docutils literal notranslate"><span class="pre">[0.1*pi,</span> <span class="pre">1.9*pi]</span></code>?).</p>
<p>The problem is solved by using integration over <code class="docutils literal notranslate"><span class="pre">complex`r</span> <span class="pre">numbers.</span>
<span class="pre">Briefly,</span> <span class="pre">complex</span> <span class="pre">numbers</span> <span class="pre">represent</span> <span class="pre">a</span> <span class="pre">point</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">complex</span> <span class="pre">plane,</span> <span class="pre">where</span> <span class="pre">the</span> <span class="pre">real</span> <span class="pre">part</span> <span class="pre">is</span> <span class="pre">the</span> <span class="pre">``x</span></code>-coordinate
and the imaginary part is the <code class="docutils literal notranslate"><span class="pre">y</span></code>-coordinate.</p>
<p>This is what the complex plane looks like for the first 10 data points of the <strong>attended</strong> condition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s plot the firs 10 trials in the complex plane</span>
<span class="n">first_10_trials</span> <span class="o">=</span> <span class="n">experimental_paradigm</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s1">&#39;attended&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;condition&#39;</span><span class="p">)[</span><span class="s1">&#39;x (radians)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>

<span class="n">orientations_complex</span> <span class="o">=</span> <span class="n">to_complex</span><span class="p">(</span><span class="n">first_10_trials</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">orientations_complex</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">orientations_complex</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">first_10_trials</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

</pre></div>
</div>
<p class="centered">
<strong><img alt="10trials_complex_plane" src="../_images/sphx_glr_decode2d_006.png" /></strong></p><p>If we now want to take integrals/expectations/averages over angles, we can simply
take the average over the complex numbers that represent the angles. which
is equivalent to taking the average over the unit circle in the complex plane.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get posterior means by integrating over complex numbers</span>
<span class="k">def</span> <span class="nf">wrap_angle</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="k">def</span> <span class="nf">get_posterior_stats</span><span class="p">(</span><span class="n">posterior</span><span class="p">,</span> <span class="n">ground_truth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">posterior</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">complex_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">to_complex</span><span class="p">(</span><span class="n">posterior</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

    <span class="c1"># Take integral over the posterior to get to the expectation (mean posterior)</span>
    <span class="c1"># In this case a complex number that we convert back to an angle between 0 and 2pi</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">from_complex</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">posterior</span><span class="o">*</span><span class="n">complex_grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Take the integral over the posterior to get the expectation of the distance to the</span>
    <span class="c1"># mean posterior (i.e., standard deviation)</span>
    <span class="n">relative_error</span> <span class="o">=</span> <span class="n">E</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">posterior</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>

    <span class="c1"># Wrap the angle to be between 0 and pi, the error can never be larger than pi (180 degrees)</span>
    <span class="n">relative_error</span> <span class="o">=</span> <span class="n">wrap_angle</span><span class="p">(</span><span class="n">relative_error</span><span class="p">)</span>
    <span class="n">absolute_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">relative_error</span><span class="p">)</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">absolute_error</span> <span class="o">*</span> <span class="n">posterior</span><span class="p">,</span> <span class="n">posterior</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="n">E</span><span class="p">,</span> <span class="s1">&#39;sd&#39;</span><span class="p">:</span><span class="n">sd</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">posterior</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ground_truth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;E_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrap_angle</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ground_truth</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;E_error_abs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;E_error&#39;</span><span class="p">])</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ground_truth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ground_truth</span>

    <span class="k">return</span> <span class="n">stats</span>

<span class="n">posterior_stats</span> <span class="o">=</span> <span class="n">get_posterior_stats</span><span class="p">(</span><span class="n">conditional_orientation_ll</span><span class="p">,</span> <span class="n">ground_truth</span><span class="o">=</span><span class="n">experimental_paradigm</span><span class="p">[</span><span class="s1">&#39;x (radians)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># Circular correlations:</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="n">posterior_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;condition&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">circ_corrcc</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ground_truth&#39;</span><span class="p">],</span> <span class="kc">True</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rho</th>
      <th>p</th>
    </tr>
    <tr>
      <th>condition</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>attended</th>
      <td>0.965557</td>
      <td>1.010416e-16</td>
    </tr>
    <tr>
      <th>unattended</th>
      <td>0.471372</td>
      <td>4.337842e-07</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Note how the correlation between the ground truth and posterior mean
is much higher for the attended condition than the unattended condition.</p>
<p>Also note that you should never use normal (e.g., Pearson’s) correlation
on angles!</p>
<p>We can now also plot the mean posteriors in the complex plane:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s see how far the posterior mean is from the ground truth</span>
<span class="c1"># by plotting the estimates and groun truth in the complex plane</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Create custom legend</span>
<span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Estimate&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Truth&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Attended&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unattended&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Plot the data</span>
<span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">posterior_stats</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">hue</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[[</span><span class="s1">&#39;attended&#39;</span><span class="p">,</span> <span class="s1">&#39;unattended&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ix</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

    <span class="n">estimate_complex</span> <span class="o">=</span> <span class="n">to_complex</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">])</span>
    <span class="n">ground_truth_complex</span> <span class="o">=</span> <span class="n">to_complex</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;ground_truth&#39;</span><span class="p">])</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">estimate_complex</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">ground_truth_complex</span><span class="o">.</span><span class="n">real</span><span class="p">],</span> <span class="p">[</span><span class="n">estimate_complex</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">ground_truth_complex</span><span class="o">.</span><span class="n">imag</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">hue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">estimate_complex</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">estimate_complex</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hue</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ground_truth_complex</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">ground_truth_complex</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hue</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="c1"># Set aspect ratio and remove spines</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="c1"># Add legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">)</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
<p class="centered">
<strong><img alt="estimates_complex_plane" src="../_images/sphx_glr_decode2d_007.png" /></strong></p><p>Note how the unattended condition is, indeed, generally much further away from the ground truth
than the attended condition.</p>
<p>Note, also that even <strong>within</strong> conditions we can predict the error of the classifier
by using the variance of the posterior distribution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the error as a function of the standard deviation of the posterior</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;E_error_abs&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">posterior_stats</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">)</span>

</pre></div>
</div>
<p class="centered">
<strong><img alt="error_vs_posterior_sd" src="../_images/sphx_glr_decode2d_008.png" /></strong></p><section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<div class="docutils container" id="id4">
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-serences2007spatially" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>John T Serences and Steven Yantis. Spatially selective representations of voluntary and stimulus-driven attentional priority in human occipital, parietal, and frontal cortex. <em>Cerebral cortex</em>, 17(2):284–293, 2007. URL: <a class="reference external" href="https://drive.google.com/file/d/16-t8zlMJlHIK5Qt8MeJy6NK5r9WzjgT9/view?usp=sharing">https://drive.google.com/file/d/16-t8zlMJlHIK5Qt8MeJy6NK5r9WzjgT9/view?usp=sharing</a>.</p>
</aside>
<aside class="footnote brackets" id="footcite-sprague2013attention" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Thomas C Sprague and John T Serences. Attention modulates spatial priority maps in the human occipital, parietal and frontal cortices. <em>Nature neuroscience</em>, 16(12):1879–1887, 2013. URL: <a class="reference external" href="https://www.nature.com/articles/nn.3574">https://www.nature.com/articles/nn.3574</a>.</p>
</aside>
<aside class="footnote brackets" id="footcite-sawetsuttipan2023perceptual" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Prapasiri Sawetsuttipan, Phond Phunchongharn, Kajornvut Ounjai, Annalisa Salazar, Sarigga Pongsuwan, Singh Intrachooto, John T Serences, and Sirawaj Itthipuripat. Perceptual difficulty regulates attentional gain modulations in human visual cortex. <em>Journal of Neuroscience</em>, 43(18):3312–3330, 2023. URL: <a class="reference external" href="https://www.jneurosci.org/content/43/18/3312">https://www.jneurosci.org/content/43/18/3312</a>.</p>
</aside>
</aside>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="lesson7.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Lesson 7: Fitting PRF models to visual space</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="lesson5.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Lesson 5: Decoding noisy neural data</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Gilles de Hollander
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>